var skatLib=function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t,n){const{PhotoPosts:s}=n(5),{editPostPlace:o}=n(3);let r,a,i;function l(e){const t=document.createElement("li");t.id=`post${e._id}`,t.innerHTML=`<header class="userInfo flex">\n      <a href="#">\n        <img class="userAvatar" src="https://uc.uxpin.com/files/839015/832598/image-612fd1.png">\n      </a>\n      <a class="username" href="#"><b>${e.author}</b></a>\n        ${r===e.author?'<div class="editDelete">\n          <a href="#">\n            <i class="material-icons">edit</i>\n          </a>    \n        <div class="editDeletePopup">\n          <a href="#" class="editDeleteMenuItem">Edit</a>\n          <a href="#" class="editDeleteMenuItem">Delete</a>\n        </div>\n      </div>':""}\n    </header>\n    <img class="photo" src="${e.photoLink}">\n    <a href="#" class="star">\n      <i class="material-icons font40"${e.likes.includes(r)?'style="color:red"> favorite':">favorite_border"}</i>\n    </a>\n    <div class="amountOfLikes">\n      <i><b>${e.likes.length} likes</b></i>\n    </div>\n    <div class="comment">\n      <a class="username" href="#"><b>${e.author}:</b></a>\n      <span>${e.description}</span>\n    </div>\n    <span class="publDate">${new Date(e.publDate).toLocaleString()}</span>`,t.childNodes[4].childNodes[1].addEventListener("click",d);const n=t.querySelectorAll(".editDeleteMenuItem");return n.length&&(n[0].addEventListener("click",o),n[1].addEventListener("click",u)),t}function c(e){let t=new XMLHttpRequest;t.open("DELETE","/api/posts/removepost"),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onload=(()=>{if(200===t.status){const n=JSON.parse(t.response);if(n.success){s.prototype.removePhotoPost.call(a,e);const t=document.getElementById(`post${e}`);t&&document.getElementsByTagName("ul")[0].removeChild(t)}else console.log(n.extras)}else console.log(JSON.parse(t.response).extras)}),t.send(`id=${e}`)}function d(e){if(e.preventDefault(),!r)return;const t=e.target.closest("li").id.substr(4),n=s.prototype.getPhotoPost.call(a,t);if(!n)return;let o=n.likes.indexOf(r);-1===o?(n.likes.push(r),e.target.style="color:red",e.target.innerHTML="favorite"):(n.likes.splice(o,1),e.target.style="color:black",e.target.innerHTML="favorite_border"),e.target.parentNode.nextSibling.nextSibling.innerHTML=`<i><b>${n.likes.length} likes</i></b>`;let i=new XMLHttpRequest;i.open("POST","/api/posts/editpost"),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(`id=${t}&likes=${JSON.stringify(n.likes)}`)}function u(e){return e.preventDefault(),c(e.target.closest("li").id.substr(4))}e.exports={addPost:function(e){let t=new XMLHttpRequest;t.open("PUT","/api/posts/createpost"),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onload=(()=>{if(200===t.status){const n=JSON.parse(t.response);if(n.success){s.prototype.addPost.call(a,n.extras.post);let t=a.arr.indexOf(n.extras.post),o=document.querySelector("ul");t<o.childNodes.length&&o.insertBefore(l(e),o.childNodes[t])}else console.log(n.extras)}else console.log(JSON.parse(t.response).extras)}),console.log(e),t.send(`photourl=${e.photoLink}&description=${e.description}`)},addPosts:function e(t){const n=document.getElementsByTagName("ul")[0];if(!t||"object"!=typeof t){if("function"!=typeof i)return!1;const{arr:e,finished:t}=i();for(let t=0;t<e.length;t++)n.appendChild(l(e[t]));return t&&(document.getElementsByTagName("button")[0].style="display:none"),!0}{let o=new XMLHttpRequest;o.open("GET","/api/posts/getposts"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onload=(()=>{if(200===o.status){const r=JSON.parse(o.response);r.success&&((a={arr:r.extras.posts}).arr.sort((e,t)=>new Date(t.publDate)-new Date(e.publDate)),n.innerHTML="",document.getElementsByTagName("button")[0].style="display:block",i=(()=>{let e=0;const{arr:n}=s.prototype.getPhotoPosts.call(a,0,1/0,t);return function(){return e+=5,{arr:n.slice(e-5,e),finished:e>=n.length}}})(),e())}}),o.send()}},removePhotoPost:c,deleteEl:u,editPhotoPost:function(e,t){let n=new XMLHttpRequest;n.open("POST","/api/posts/editpost"),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onload=(()=>{if(200===n.status){const o=JSON.parse(n.response);if(o.success){s.prototype.editPhotoPost.call(a,e,t);const n=document.getElementById(`post${e}`);n&&document.getElementsByTagName("ul")[0].replaceChild(l(s.prototype.getPhotoPost.call(a,e)),n)}else console.log(o.extras)}else console.log(JSON.parse(n.response).extras)}),n.send(`photourl=${t.photoLink}&description=${t.description}&id=${e}`)},createPostHtml:l,getPosts:function(){return a()},firstLoad:function(){let e=new XMLHttpRequest;e.open("GET","/api/account/user"),e.onload=(()=>{200===e.status&&(r=JSON.parse(e.response).extras.user),n(1)({})}),e.send()},deleteUser:function(){r=null},getUser:function(){return r},setUser:function(e){r=e}}},function(e,t,n){const s=n(16),o=n(15),r=n(14),{createPostPlace:a}=n(3),i=n(13),{redirectToLogin:l}=n(2);e.exports=function(e={}){document.getElementById("body").innerHTML=s(),document.querySelector(".search").addEventListener("submit",r);const t=document.querySelector(".postCreateButton");t&&t.addEventListener("click",a);const n=document.querySelector(".editDeleteMenuItem");"Logout"===n.innerHTML?n.addEventListener("click",i):n.addEventListener("click",l),o(e)}},function(e,t,n){const s=n(12),o=n(11),r=n(10),a=n(9),i=n(8),l=n(7),{sendHash:c,resetPassword:d}=n(6);function u(e){e.preventDefault(),document.getElementById("body").innerHTML=s(),document.querySelector(".inputForm").addEventListener("submit",o),document.querySelector(".redirectToLogon").addEventListener("click",p)}function p(e){e.preventDefault(),document.getElementById("body").innerHTML=a(),document.querySelector(".inputForm").addEventListener("submit",r),document.querySelector(".reset-pwd").addEventListener("click",f),document.querySelector(".signUpOfferLink").addEventListener("click",u)}function f(e){e.preventDefault(),document.querySelector("body").innerHTML=i(),document.querySelector(".redirectToLogon").addEventListener("click",p),document.querySelector(".inputForm").addEventListener("submit",c),document.querySelector(".signUpOfferLink").addEventListener("click",m)}function m(e){e.preventDefault(),document.querySelector("body").innerHTML=l(),document.querySelector(".redirectToLogon").addEventListener("click",p),document.querySelector(".inputForm").addEventListener("submit",d),document.querySelector(".signUpOfferLink").addEventListener("click",f)}e.exports={redirectToLogin:p,redirectToRegister:u,redirectToSendResetHash:f,redirectToResetPassword:m}},function(e,t,n){const s=n(17),{PhotoPost:o}=n(4),{PhotoPosts:r}=n(5);function a(e){e.preventDefault();const t=e.target.parentNode;if(t.id){const e=t.id.substr(4);t.replaceWith(n(0).createPostHtml(r.prototype.getPhotoPost.call(n(0).getPosts(),e)))}else t.remove()}function i(e){e.preventDefault();const t=e.target.parentNode;if(t.id){const e=t.id.substr(4);n(0).editPhotoPost(e,{description:t.querySelector(".addDescr").innerHTML,photoLink:t.querySelector(".addUrl").value})}else{const e=new o(n(0).getUser(),Date.now(),t.querySelector(".addDescr").innerText,t.querySelector(".addUrl").value,[]);document.querySelector("ul").removeChild(document.querySelector(".editPost")),n(0).addPost(e),console.log(e),console.log(e.validate())}}e.exports={createPostPlace:function(e){e.preventDefault();const t=document.querySelector("ul");if(!t)return!1;if(t.querySelector(".editPost"))return!1;const n=document.createElement("li");n.innerHTML=s(),n.className="editPost",n.querySelector("form").addEventListener("submit",i),n.querySelector("form").addEventListener("reset",a),t.insertBefore(n,t.children[0])},editPostPlace:function(e){e.preventDefault();const t=e.target.closest("li");t.innerHTML=s(t.querySelector(".photo").src,t.querySelector(".comment>span").innerHTML),t.querySelector("form").addEventListener("reset",a),t.querySelector("form").addEventListener("submit",i)}}},function(e,t){let n=localStorage.posts?JSON.parse(localStorage.posts).arr.reduce((e,t)=>Number.parseInt(t._id)>e?Number.parseInt(t._id)+1:e,1):1;e.exports={PhotoPost:class{constructor(e,t,s,o,r=[]){this.author=e,this.publDate=new Date(t),this.likes=r,this._id=(n++).toString(),this.description=s,this.photoLink=o,this.tags=s.match(/#[^\s#]*/g)||[]}validate(){return!!("string"==typeof this.author&&"string"==typeof this.description&&this.publDate&&this.author&&this.photoLink&&"string"==typeof this.photoLink&&this.likes instanceof Array&&this.likes.reduce((e,t)=>"string"==typeof t,!0)&&"string"==typeof this._id&&this.publDate instanceof Date)}}}},function(e,t,n){const{PhotoPost:s}=n(4);e.exports={PhotoPosts:class{constructor(){this.arr=[]}addPost(e){return!this.arr.find(t=>t._id===e._id)&&(this.arr.push(e),this.arr.sort((e,t)=>new Date(t.publDate)-new Date(e.publDate)),!0)}getPhotoPosts(e=0,t=10,n={}){if("number"!=typeof e||"number"!=typeof t||"object"!=typeof n)return console.log("Incorrect getPhotoPosts params"),!1;let s=this.arr.filter(e=>(!(n.authors instanceof Array)||n.authors.includes(e.author))&&(!(n.tags instanceof Array)||n.tags.every(t=>e.tags.includes(t)))&&(!(n.startDate instanceof Date)||new Date(e.publDate)>=n.startDate)&&(!(n.endDate instanceof Date)||new Date(e.publDate)<=n.endDate));return{arr:s.slice(e,e+t),finished:e+t>=s.length}}getPhotoPost(e){return this.arr.find(t=>t._id===e)}editPhotoPost(e,t){const n=this.arr.findIndex(t=>t._id===e);if(-1===n)return console.log("No posts with such ID"),!1;const o=Object.create(this.arr[n].__proto__);for(let e in this.arr[n])o[e]=this.arr[n][e];const r=["description","author","publDate","likes","photoLink"];for(let e of r)o[e]=void 0!==t[e]?t[e]:o[e];return o.tags=o.description.match(/#[^\s#]*/g),o.publDate&&(o.publDate=new Date(o.publDate)),s.prototype.validate.call(o)?(this.arr[n]=o,!0):(console.log("Incorrect post editing"),!1)}removePhotoPost(e){let t=this.arr.findIndex(t=>t._id===e);return-1===t?(console.log("No posts with such ID"),!1):(this.arr.splice(t,1),!0)}}}},function(e,t,n){e.exports={sendHash:function(e){e.preventDefault();let t=new XMLHttpRequest;t.open("POST","/api/account/resetpassword"),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onload=(()=>{200===t.status&&JSON.parse(t.response).success&&n(2).redirectToResetPassword(e)}),t.send(`email=${document.querySelector(".logonEmail").value}`)},resetPassword:function(e){e.preventDefault();let t=new XMLHttpRequest;t.open("POST","/api/account/resetpasswordfinal"),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onload=(()=>{200===t.status&&JSON.parse(t.response).success&&n(2).redirectToLogin(e)}),t.send(`email=${document.querySelector(".logonEmail").value}&newPassword=${document.querySelector(".logonPassword").value}&newPasswordConfirm=${document.querySelectorAll(".logonPassword")[1].value}&passwordResetHash=${document.querySelectorAll(".logonEmail")[1].value}`)}}},function(e,t){e.exports=function(){return'<div class="logonBackground">\n      <div class="logonDiv">\n        <b class="signIn">Reset password</b>\n        <img class="logonLogo" src="https://uc.uxpin.com/files/839015/832598/image-612fd1.png">\n        <form class="inputForm">\n          <input class="logonEmail" type="email" placeholder="Email address" required>\n          <input class="logonEmail" placeholder="Reset hash" required>\n          <input class="logonPassword" placeholder="New password" required>\n          <input class="logonPassword" placeholder="new password confirm" required>\n          <input class="logonButton" type="submit" value="Send reset hash">\n        </form>\n        <a href="#" class="redirectToLogon">Remember your password?</a>\n      </div>\n      <a class="signUpOfferLink" href="#">Don\'t have hash?</a>\n    </div>'}},function(e,t){e.exports=function(){return'<div class="logonBackground">\n      <div class="logonDiv">\n        <b class="signIn">Reset password</b>\n        <img class="logonLogo" src="https://uc.uxpin.com/files/839015/832598/image-612fd1.png">\n        <form class="inputForm">\n          <input class="logonEmail" type="email" placeholder="Email address" required>\n          <input class="logonButton" type="submit" value="Send reset hash">\n        </form>\n        <a href="#" class="redirectToLogon">Remember your password?</a>\n      </div>\n      <a class="signUpOfferLink" href="#">Already have hash?</a>\n    </div>'}},function(e,t){e.exports=function(){return'<div class="logonBackground">\n      <div class="logonDiv">\n        <b class="signIn">Sign in</b>\n        <img class="logonLogo" src="https://uc.uxpin.com/files/839015/832598/image-612fd1.png">\n        <form class="inputForm">\n          <input class="logonEmail" type="email" placeholder="Email address" required>\n          <input class="logonPassword" type="password" placeholder="Password" required>\n          <input class="logonButton" type="submit" value="Logon">\n        </form>  \n        <a class="reset-pwd" href="#">Forgot your password?</a>\n      </div>\n      <div class="signUpOffer">\n        <span>Don\'t have an account?</span>\n        <a class="signUpOfferLink" href="#">Signup</a>\n      </div>\n    </div>'}},function(e,t,n){e.exports=function(e){e.preventDefault();const t=document.getElementsByClassName("logonEmail")[0].value,s=document.getElementsByClassName("logonPassword")[0].value;let o=new XMLHttpRequest;o.open("POST","/api/account/logon"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onload=(()=>{200===o.status&&JSON.parse(o.response).success&&(n(0).setUser(JSON.parse(o.response).extras.userProfileModel.nickname),n(1)())}),o.send(`email=${t}&password=${s}`)}},function(e,t,n){e.exports=function(e){e.preventDefault();const[t,s]=document.getElementsByClassName("logonEmail"),[o,r]=document.getElementsByClassName("logonPassword");let a=new XMLHttpRequest;a.open("POST","/api/account/register"),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=(()=>{200===a.status&&JSON.parse(a.response).success?(n(0).setUser(s.value),n(1)()):console.log(JSON.parse(a.response).extras)}),a.send(`email=${t.value}&nickname=${s.value}&password=${o.value}&passwordConfirm=${r.value}`)}},function(e,t){e.exports=function(){return'\n  <div class="logonBackground">\n    <div class="logonDiv">\n      <b class="signIn">Sign up</b>\n      <img class="logonLogo" src="https://uc.uxpin.com/files/839015/832598/image-612fd1.png">\n      <form class="inputForm">\n        <input class="logonEmail" type="email" placeholder="Email address">\n        <input class="logonEmail" placeholder="Nickname">\n        <input class="logonPassword" type="password" placeholder="Password">\n        <input class="logonPassword" type="password" placeholder="Password Confirm">\n        <input class="logonButton" type="submit" value="Register">\n      </form>  \n      <a href="#" class="redirectToLogon">Already have an account?</a>\n    </div>\n  </div>'}},function(e,t,n){e.exports=function(e){e.preventDefault();let t=new XMLHttpRequest;t.open("POST","/api/account/logoff"),t.onload=(()=>{200===t.status&&JSON.parse(t.response).success&&(n(0).deleteUser(),n(1)())}),t.send()}},function(e,t,n){e.exports=function(){const e={},t=document.getElementsByClassName("filterByTagAndName")[0].value,s=t.match(/#[^\s#]*/g);let o=t.match(/([^#\S]|^)[^\s#]+/g);o=o?o.map(e=>" "===e[0]?e.substr(1):e):null;let[r,a]=document.getElementsByClassName("dateInputs")[0].getElementsByTagName("input");r=r.value,a=a.value,r&&(e.startDate=new Date(r)),a&&(e.endDate=new Date(a),e.endDate.setDate(e.endDate.getDate()+1)),o&&(e.authors=o),s&&(e.tags=s),n(1)(e)}},function(e,t,n){const{addPosts:s}=n(0);e.exports=function(e={}){const t=document.getElementsByClassName("content")[0];t.innerHTML='<ul class="flex"></ul>\n        <button class="uploadOlder">Show older photos</button>',t.querySelector(".uploadOlder").addEventListener("click",()=>s()),s(e)}},function(e,t,n){e.exports=function(){return`\n    <header class="header flex">\n      <div class="headerDiv center flex">\n        <a href="#" class="logo flex">\n          <img class="logoImage" src="https://uc.uxpin.com/files/839015/832598/image-612fd1.png">\n          <div class="verticalLine"></div>\n          <p class="appName"><b>Ugagram</b></p>\n        </a>\n        <form class="search flex">\n          <div class="help">You may search for A's and B's post, tagged with #c#d via typing "A B #c#d"</div>\n          <input class="filterByTagAndName center" type="text" placeholder="Search">\n          <div class="dateRange flex">\n            <i class="material-icons center font30">date_range</i>\n            <div class="dateInputs">\n              <i>from:</i>\n              <input type="date" min="1979-12-31">\n              <i>to:</i>\n              <input type="date" min="1979-12-31">\n            </div>                \n          </div>   \n        </form>\n        <div class="userButtons flex">\n          ${n(0).getUser()?'<a href="#" class="postCreateButton">\n            <i class="font40 center"><b>+</b></i>\n          </a>':""}\n          <div class="editDelete">\n            <a href="#">\n              <i class="material-icons font40 center accountPopup">\n                person\n              </i>\n            </a>\n            <div class="profilePopup">\n              ${n(0).getUser()?`<b>${n(0).getUser()}</b>\n              <a href="#" class="editDeleteMenuItem">Logout</a>`:'\n              <a href="#" class="editDeleteMenuItem">Login</a>'}\n            </div>\n          </div>\n        </div>\n      </div>\n    </header>\n    <div class="content">\n    </div>\n    <footer class="flex">\n      <div class="logo flex">\n        <p class="appName"><b>Ugagram</b></p>\n      </div>\n      <div class="footerInfo">\n        <p>All content c 2018 Alexander Kovalchuk</p>\n        <p>FAMCS, group 5</p>\n        <p>last update: 02.04.2018</p>\n      </div>\n      <div class="contacts">\n        <p>Contact Email: <b>skateray17@gmail.com</b></p>\n      </div>\n    </footer>`}},function(e,t){e.exports=function(e="",t=""){return`<form class="inputForm">\n      <b>Photo url:</b>\n      <input class="addUrl" type="url" value="${e}">\n      <b>Description:</b>\n      <div class="addDescr" contenteditable="true">${t}</div>\n      <div>\n        <input type="submit" value="Save"><input type="reset" value="cancel">\n      </div>\n    </form>`}},function(e,t,n){n(0).firstLoad()}]);